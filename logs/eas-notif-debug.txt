# EAS Notification Debug Runbook

## Diagnostic Commands

### 1. Build Debug EAS Build
```bash
eas build --platform android --profile preview
```

### 2. Install on Test Device
```bash
# Download APK from EAS dashboard and install
adb install -r path/to/your-app.apk
```

### 3. Monitor Notifications with ADB
```bash
# Clear existing logs
adb logcat -c

# Monitor app-specific logs (replace with your package name)
adb logcat | grep "com.medimind.ai"

# Monitor notification-specific logs
adb logcat | grep -E "(Notification|SCHEDULE|FIRE|CANCEL)"

# Monitor all logs for the app
adb logcat | grep "MediMind"
```

### 4. Test Notification Flow
1. Open app and schedule a test medicine for 2 minutes from now
2. Let notification fire
3. Ignore the notification
4. Observe follow-up funny reminders
5. Take action (check box) and verify funny reminders stop

### 5. Save Logs
```bash
# Save last 200 lines of filtered logs
adb logcat | grep "com.medimind.ai" | tail -200 > logs/eas-notif-debug.txt
```

## Expected Log Patterns

### Primary Notification Firing
```
[SCHEDULE] medicineId=... when=... id=...
[FIRE_PRIMARY] logId=... notifId=...
[MARK_AS_DUE] logId=...
[SCHEDULE_FUNNY] logId=... attempt=1
```

### Funny Reminder Chain
```
[FIRE_FUNNY] logId=... attempt=1
[SCHEDULE_FUNNY] logId=... attempt=2
[FIRE_FUNNY] logId=... attempt=2
[SCHEDULE_FUNNY] logId=... attempt=3
```

### User Action
```
[MARK_AS_TAKEN] logId=...
[CANCEL_FUNNY_CHAIN] logId=...
```

## Common Issues to Look For

1. **Delayed Primary Notifications**: Look for large time gaps between scheduled and fired times
2. **Missing Funny Reminders**: Check if [SCHEDULE_FUNNY] logs appear but [FIRE_FUNNY] don't
3. **Duplicate Notifications**: Look for multiple [SCHEDULE] entries for same medicine/time
4. **Permission Issues**: Check for "permission denied" or "exact alarm" related errors

## Platform Limitations

- Android Doze mode may delay notifications
- Battery optimization can affect exact timing
- SCHEDULE_EXACT_ALARM permission required on Android 12+
- POST_NOTIFICATIONS permission required on Android 13+

## Test Results Template

### Test Date: ___________
### Device: ___________
### Android Version: ___________
### Build Type: EAS Preview/Production

### Primary Notification Test
- [ ] Notification fired on time (±30 seconds)
- [ ] Log shows [FIRE_PRIMARY] and [MARK_AS_DUE]
- [ ] Today Medicines list updated with checkbox

### Funny Reminder Test
- [ ] First funny reminder fired after 4 minutes
- [ ] Subsequent reminders fired every 4 minutes
- [ ] Reminders stopped when medicine marked as taken
- [ ] Log shows [CANCEL_FUNNY_CHAIN] when action taken

### Edge Cases
- [ ] Editing medicine time cancels old notifications
- [ ] App restart doesn't lose scheduled notifications
- [ ] Device reboot preserves notification schedule

### Issues Found:
1. ___________
2. ___________
3. ___________

### Logs Saved: ✅ / ❌
